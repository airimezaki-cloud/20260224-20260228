import React, { useState, useEffect } from 'react';
import { 
  CheckCircle2, 
  Circle, 
  MapPin, 
  Clock, 
  AlertTriangle, 
  ChevronRight, 
  ExternalLink,
  Castle,
  CalendarDays
} from 'lucide-react';

const App = () => {
  const [activeDay, setActiveDay] = useState('day1');
  const [visited, setVisited] = useState({});

  // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰é€²æ—ã‚’å¾©å…ƒ
  useEffect(() => {
    const saved = localStorage.getItem('castle_rally_progress');
    if (saved) {
      try {
        setVisited(JSON.parse(saved));
      } catch (e) {
        console.error("Failed to parse progress", e);
      }
    }
  }, []);

  // è¨ªå•çŠ¶æ…‹ã®åˆ‡ã‚Šæ›¿ãˆã¨ä¿å­˜
  const toggleVisited = (id) => {
    const newVisited = { ...visited, [id]: !visited[id] };
    setVisited(newVisited);
    localStorage.setItem('castle_rally_progress', JSON.stringify(newVisited));
  };

  const scheduleData = {
    day1: {
      date: "2/24 (ç«)",
      title: "å‚™ä¸­ã‚¨ãƒªã‚¢ã®å±±åŸæ”»ç•¥",
      note: "â€»ç¥æ—¥æŒ¯æ›¿æ—¥ã®ãŸã‚è³‡æ–™é¤¨ã¯ä¼‘é¤¨ã€‚ä»£æ›¿ã‚¹ã‚¿ãƒ³ãƒ—å ´æ‰€ã‚’å„ªå…ˆã€‚",
      castles: [
        {
          id: 68,
          name: "å‚™ä¸­æ¾å±±åŸ",
          timeSlot: "09:00 - 11:30",
          description: "æ—¥æœ¬ä¸€é«˜ã„ç¾å­˜å¤©å®ˆã€‚é›²æµ·ã«æµ®ã‹ã¶å¤©ç©ºã®åŸã€‚",
          parking: "https://www.google.com/maps/search/?api=1&query=åŸè¦‹æ©‹å…¬åœ’é§è»Šå ´",
          stamp: "https://www.google.com/maps/search/?api=1&query=å‚™ä¸­æ¾å±±åŸ+å¤©å®ˆ",
          hours: "9:00 - 16:30",
          warning: "é§è»Šå ´ã‹ã‚‰ã‚·ãƒ£ãƒˆãƒ«ãƒã‚¹åˆ©ç”¨ã€‚ãã“ã‹ã‚‰å¾’æ­©20åˆ†ã®å±±é“ã§ã™ã€‚"
        },
        {
          id: 171,
          name: "å‚™ä¸­é«˜æ¾åŸ",
          timeSlot: "12:30 - 14:00",
          description: "ç§€å‰ã®æ°´æ”»ã‚èˆå°ã€‚åŸä¸»ãƒ»æ¸…æ°´å®—æ²»ã®åˆ‡è…¹åœ°ã€‚",
          parking: "https://www.google.com/maps/search/?api=1&query=å‚™ä¸­é«˜æ¾åŸè·¡é§è»Šå ´",
          stamp: "https://www.google.com/maps/search/?api=1&query=å‚™ä¸­é«˜æ¾åŸè·¡+æ¸…é¡åºµ",
          hours: "è‡ªç”±ï¼ˆ2/24è³‡æ–™é¤¨ã¯ä¼‘é¤¨ï¼‰",
          warning: "ã‚¹ã‚¿ãƒ³ãƒ—ã¯éš£æ¥å£²åº—ã€Œæ¸…é¡åºµã€ã«ã‚ã‚Šã¾ã™ã€‚"
        },
        {
          id: 69,
          name: "é¬¼ãƒåŸ",
          timeSlot: "14:30 - 16:30",
          description: "å¤ä»£æœé®®å¼å±±åŸã€‚è¥¿é–€ã¨å·¨å¤§ãªçŸ³å£ãŒè¦‹æ‰€ã€‚",
          parking: "https://www.google.com/maps/search/?api=1&query=é¬¼ãƒåŸãƒ“ã‚¸ã‚¿ãƒ¼ã‚»ãƒ³ã‚¿ãƒ¼",
          stamp: "https://www.google.com/maps/search/?api=1&query=ç·ç¤¾å¸‚å½¹æ‰€",
          hours: "è‡ªç”±ï¼ˆ2/24ãƒ“ã‚¸ã‚¿ãƒ¼Cã¯ä¼‘é¤¨ï¼‰",
          warning: "ãƒ“ã‚¸ã‚¿ãƒ¼Cä¼‘é¤¨ã€‚ã‚¹ã‚¿ãƒ³ãƒ—ã¯ç·ç¤¾å¸‚å½¹æ‰€ã®å®ˆè¡›å®¤ç­‰ã§æä¾›ã€‚"
        }
      ]
    },
    day2: {
      date: "2/25 (æ°´)",
      title: "é¦™å·ã®ç¾å­˜å¤©å®ˆã¨æµ·åŸ",
      note: "ã†ã©ã‚“å·¡ã‚Šã¨ä¸¦è¡Œã—ã‚„ã™ã„ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã€‚",
      castles: [
        {
          id: 78,
          name: "ä¸¸äº€åŸ",
          timeSlot: "09:00 - 10:30",
          description: "æ—¥æœ¬ä¸€é«˜ã„çŸ³å£ã¨ç¾å­˜æœ€å°ã®å¤©å®ˆã€‚",
          parking: "https://www.google.com/maps/search/?api=1&query=ä¸¸äº€åŸå¤§æ‰‹é–€é§è»Šå ´",
          stamp: "https://www.google.com/maps/search/?api=1&query=ä¸¸äº€åŸå¤©å®ˆ",
          hours: "9:00 - 16:30",
          warning: "å¤©å®ˆã¾ã§ã®ã€Œè¦‹è¿”ã‚Šå‚ã€ã¯éå¸¸ã«æ€¥å‹¾é…ã§ã™ã€‚"
        },
        {
          id: 77,
          name: "é«˜æ¾åŸ",
          timeSlot: "11:30 - 13:30",
          description: "æ—¥æœ¬ä¸‰å¤§æµ·åŸã€‚å €ã«é¯›ãŒæ³³ãç‰è—»å…¬åœ’ã€‚",
          parking: "https://www.google.com/maps/search/?api=1&query=ç‰è—»å…¬åœ’æ±é§è»Šå ´",
          stamp: "https://www.google.com/maps/search/?api=1&query=é«˜æ¾åŸç®¡ç†äº‹å‹™æ‰€",
          hours: "8:30 - 17:00",
          warning: "å €ã®é¯›ã«ã‚¨ã‚µã‚’ã‚ã’ã‚‹ã€Œé¯›é¡˜æˆå°±ã€ãŒåç‰©ã€‚"
        },
        {
          id: 177,
          name: "å¼•ç”°åŸ",
          timeSlot: "15:00 - 16:30",
          description: "ç€¬æˆ¸å†…ã‚’è¦‹ä¸‹ã‚ã™çŸ³å£ã®å±±åŸã€‚",
          parking: "https://www.google.com/maps/search/?api=1&query=ç”°ãƒæµ¦é‡å–¶å ´é§è»Šå ´",
          stamp: "https://www.google.com/maps/search/?api=1&query=è®ƒå·äº•ç­’å±‹æ•·",
          hours: "10:00 - 16:00 (äº•ç­’å±‹æ•·)",
          warning: "ã‚¹ã‚¿ãƒ³ãƒ—ã¯äº•ç­’å±‹æ•·ï¼ˆå¸‚è¡—åœ°ï¼‰ã€åŸè·¡ã¯ã‚­ãƒ£ãƒ³ãƒ—å ´æ–¹é¢ã§ã™ã€‚"
        }
      ]
    },
    day3: {
      date: "2/26 (æœ¨)",
      title: "å¾³å³¶ãƒ»æ·¡è·¯å³¶ã®æ­´å²æ¢è¨ª",
      note: "ä¸€å®®åŸã¨æ´²æœ¬åŸã¯å±±åŸã®ãŸã‚æ­©ãã‚„ã™ã„é´ã§ã€‚",
      castles: [
        {
          id: 175,
          name: "å‹ç‘åŸ",
          timeSlot: "09:00 - 10:00",
          description: "ä¸‰å¥½æ°ã®æœ¬æ‹ åœ°ã€‚è±ªè¯ãªå±…é¤¨åº­åœ’è·¡ã€‚",
          parking: "https://www.google.com/maps/search/?api=1&query=å‹ç‘åŸé¤¨è·¡é§è»Šå ´",
          stamp: "https://www.google.com/maps/search/?api=1&query=å‹ç‘ç¾å ´äº‹å‹™æ‰€",
          hours: "9:00 - 17:00",
          warning: "äº‹å‹™æ‰€ã¨åŸé¤¨è·¡ãŒå°‘ã—é›¢ã‚Œã¦ã„ã¾ã™ã€‚"
        },
        {
          id: 76,
          name: "å¾³å³¶åŸ",
          timeSlot: "10:30 - 12:30",
          description: "èœ‚é ˆè³€å®¶ã®å±…åŸã€‚é’çŸ³ã®çŸ³å£ãŒç¾ã—ã„ã€‚",
          parking: "https://www.google.com/maps/search/?api=1&query=å¾³å³¶ä¸­å¤®å…¬åœ’é§è»Šå ´",
          stamp: "https://www.google.com/maps/search/?api=1&query=å¾³å³¶å¸‚ç«‹å¾³å³¶åŸåšç‰©é¤¨",
          hours: "9:30 - 17:00",
          warning: "åšç‰©é¤¨å†…ã®åº­åœ’ã¯å¿…è¦‹ã§ã™ã€‚"
        },
        {
          id: 176,
          name: "ä¸€å®®åŸ",
          timeSlot: "14:00 - 15:30",
          description: "å²©ç›¤ã‚’å‰Šã£ãŸå €åˆ‡ãŒè¦‹äº‹ãªå±±åŸã€‚",
          parking: "https://www.google.com/maps/search/?api=1&query=ä¸€å®®ç¥ç¤¾é§è»Šå ´",
          stamp: "https://www.google.com/maps/search/?api=1&query=ä¸€å®®åŸè·¡ç™»å±±å£",
          hours: "è‡ªç”±",
          warning: "ã‚¹ã‚¿ãƒ³ãƒ—ã¯ç™»å±±å£ã®éƒµä¾¿å—ã‘é¢¨BOXã«ã‚ã‚Šã¾ã™ã€‚"
        },
        {
          id: 164,
          name: "æ´²æœ¬åŸ",
          timeSlot: "17:00 - 18:00",
          description: "æ·¡è·¯å³¶æœ€å¤§ã®åŸã€‚çã—ã„ç™»ã‚ŠçŸ³å£ãŒç¾å­˜ã€‚",
          parking: "https://www.google.com/maps/search/?api=1&query=æ´²æœ¬åŸè·¡é§è»Šå ´",
          stamp: "https://www.google.com/maps/search/?api=1&query=æ·¡è·¯æ–‡åŒ–å²æ–™é¤¨",
          hours: "9:00 - 17:00 (å²æ–™é¤¨)",
          warning: "å…ˆã«ä¸‹ã®ã€Œå²æ–™é¤¨ã€ã§ã‚¹ã‚¿ãƒ³ãƒ—ã‚’æŠ¼ã—ã¦ã‹ã‚‰å±±ã¸ç™»ã£ã¦ãã ã•ã„ã€‚"
        }
      ]
    },
    day4: {
      date: "2/27 (é‡‘)",
      title: "å…µåº«æ¨ªæ–­ãƒ»å²¡å±±ã‚´ãƒ¼ãƒ«",
      note: "19:00ã®ãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼è¿”å´ã«åˆã‚ã›ãŸæœ€çµ‚èª¿æ•´æ—¥ã€‚",
      castles: [
        {
          id: 58,
          name: "æ˜çŸ³åŸ",
          timeSlot: "09:00 - 10:15",
          description: "å¤©å®ˆå°ã«ç«‹ã¤2åŸºã®ä¸‰é‡æ«“ãŒç¾å­˜ã€‚",
          parking: "https://www.google.com/maps/search/?api=1&query=æ˜çŸ³å…¬åœ’é§è»Šå ´",
          stamp: "https://www.google.com/maps/search/?api=1&query=æ˜çŸ³å…¬åœ’ã‚µãƒ¼ãƒ“ã‚¹ã‚»ãƒ³ã‚¿ãƒ¼",
          hours: "8:45 - 17:00",
          warning: "ã‚µãƒ¼ãƒ“ã‚¹ã‚»ãƒ³ã‚¿ãƒ¼ã¯å…¬åœ’å…¥å£è¿‘ãã«ã‚ã‚Šã¾ã™ã€‚"
        },
        {
          id: 59,
          name: "å§«è·¯åŸ",
          timeSlot: "11:15 - 14:15",
          description: "ä¸–ç•Œéºç”£ãƒ»å›½å®ã€‚ç™½é·ºåŸã¨ç§°ã•ã‚Œã‚‹ç™½äºœã®å¤©å®ˆã€‚",
          parking: "https://www.google.com/maps/search/?api=1&query=å§«è·¯åŸå¤§æ‰‹é–€é§è»Šå ´",
          stamp: "https://www.google.com/maps/search/?api=1&query=å§«è·¯åŸç®¡ç†äº‹å‹™æ‰€",
          hours: "9:00 - 17:00",
          warning: "åºƒå¤§ãªãŸã‚æœ€ä½2æ™‚é–“ã¯å¿…è¦ã€‚æ··é›‘ã«æ³¨æ„ã€‚"
        },
        {
          id: 60,
          name: "èµ¤ç©‚åŸ",
          timeSlot: "15:15 - 16:30",
          description: "å¿ è‡£è”µã®èˆå°ã€‚æŠ€å·§çš„ãªçŸ³å£ã¨åº­åœ’ã€‚",
          parking: "https://www.google.com/maps/search/?api=1&query=èµ¤ç©‚åŸè·¡é§è»Šå ´",
          stamp: "https://www.google.com/maps/search/?api=1&query=èµ¤ç©‚åŸè·¡æœ¬ä¸¸é–€",
          hours: "9:00 - 16:30",
          warning: "æœ¬ä¸¸åº­åœ’ã®å…¥å ´æ™‚é–“ã«æ³¨æ„ã€‚"
        },
        {
          id: 70,
          name: "å²¡å±±åŸ",
          timeSlot: "17:30 - 18:15",
          description: "çƒåŸã¨å‘¼ã°ã‚Œã‚‹æ¼†é»’ã®å¤–è¦³ã€‚å²¡å±±é§…è‡³è¿‘ã€‚",
          parking: "https://www.google.com/maps/search/?api=1&query=çƒåŸå…¬åœ’é§è»Šå ´",
          stamp: "https://www.google.com/maps/search/?api=1&query=å²¡å±±åŸç®¡ç†äº‹å‹™æ‰€",
          hours: "9:00 - 17:30 (æœ€çµ‚å…¥é¤¨17:00)",
          warning: "ã‚¹ã‚¿ãƒ³ãƒ—ã¯17:00ã¾ã§ã€‚ãã®å¾Œã‚¬ã‚½ãƒªãƒ³ã‚’å…¥ã‚Œ19:00è¿”å´ã¸ã€‚"
        }
      ]
    }
  };

  const currentDay = scheduleData[activeDay];
  const totalCastles = 14;
  const visitedCount = Object.values(visited).filter(v => v).length;
  const progressPercent = Math.round((visitedCount / totalCastles) * 100);

  return (
    <div className="min-h-screen bg-gray-50 font-sans text-gray-900 pb-12">
      {/* ğŸ“Š Global Progress Header */}
      <div className="bg-indigo-900 text-white p-6 shadow-xl sticky top-0 z-50">
        <div className="max-w-xl mx-auto">
          <div className="flex justify-between items-center mb-4">
            <h1 className="text-xl font-black flex items-center gap-2">
              <Castle className="text-yellow-400" /> åŸå·¡ã‚Šã‚¹ã‚¿ãƒ³ãƒ—ãƒ©ãƒªãƒ¼
            </h1>
            <div className="text-right">
              <span className="text-3xl font-bold text-yellow-400">{visitedCount}</span>
              <span className="text-sm opacity-80"> / {totalCastles}</span>
            </div>
          </div>
          <div className="bg-indigo-950 rounded-full h-4 overflow-hidden shadow-inner border border-indigo-800">
            <div 
              className="bg-yellow-400 h-full transition-all duration-700 ease-out shadow-[0_0_10px_rgba(250,204,21,0.5)]"
              style={{ width: `${progressPercent}%` }}
            />
          </div>
          <p className="text-[10px] mt-2 text-indigo-300 text-center font-bold uppercase tracking-widest">
            Total Completion: {progressPercent}%
          </p>
        </div>
      </div>

      {/* ğŸ“… Day Selector */}
      <div className="bg-white border-b sticky top-[116px] z-40 shadow-sm">
        <div className="max-w-xl mx-auto flex">
          {Object.keys(scheduleData).map((key) => (
            <button
              key={key}
              onClick={() => setActiveDay(key)}
              className={`flex-1 py-4 px-1 text-center transition-all border-b-4 font-black text-xs
                ${activeDay === key 
                  ? 'border-yellow-400 text-indigo-900 bg-yellow-50' 
                  : 'border-transparent text-gray-400 hover:bg-gray-50'}`}
            >
              <CalendarDays size={14} className="mx-auto mb-1" />
              {scheduleData[key].date}
            </button>
          ))}
        </div>
      </div>

      {/* ğŸ° Main List */}
      <div className="max-w-xl mx-auto p-4 space-y-6 mt-4">
        <div className="bg-indigo-50 border-l-4 border-indigo-500 p-4 rounded-r-xl">
          <h2 className="text-lg font-black text-indigo-900">{currentDay.title}</h2>
          <p className="text-xs text-indigo-700 font-medium mt-1">{currentDay.note}</p>
        </div>

        <div className="space-y-4">
          {currentDay.castles.map((castle, index) => (
            <div 
              key={castle.id}
              className={`relative overflow-hidden rounded-2xl transition-all border-2 
                ${visited[castle.id] 
                  ? 'bg-green-50 border-green-500 shadow-md' 
                  : 'bg-white border-gray-200 shadow-sm'}`}
            >
              {/* Progress Connector (optional visual) */}
              {index !== currentDay.castles.length - 1 && (
                <div className="absolute left-[34px] top-[80px] w-0.5 h-full bg-gray-100 -z-10" />
              )}

              {/* Card Header */}
              <div className="flex items-center justify-between p-4 border-b border-gray-100">
                <div className="flex items-center gap-3">
                  <div className={`w-10 h-10 rounded-full flex items-center justify-center font-bold text-sm
                    ${visited[castle.id] ? 'bg-green-500 text-white' : 'bg-gray-100 text-gray-400'}`}>
                    {visited[castle.id] ? <CheckCircle2 size={24} /> : `0${index + 1}`}
                  </div>
                  <div>
                    <div className="flex items-center gap-2">
                      <Clock size={12} className="text-indigo-500" />
                      <span className="text-sm font-black text-indigo-900">{castle.timeSlot}</span>
                    </div>
                  </div>
                </div>
                <button 
                  onClick={() => toggleVisited(castle.id)}
                  className={`px-4 py-2 rounded-full text-xs font-black transition-all shadow-sm
                    ${visited[castle.id] 
                      ? 'bg-green-600 text-white hover:bg-green-700' 
                      : 'bg-indigo-600 text-white hover:bg-indigo-700 active:scale-95'}`}
                >
                  {visited[castle.id] ? 'ã‚¹ã‚¿ãƒ³ãƒ—å–å¾—æ¸ˆ' : 'ã‚¹ã‚¿ãƒ³ãƒ—ã‚’æŠ¼ã™'}
                </button>
              </div>

              {/* Card Body */}
              <div className="p-5">
                <div className="flex justify-between items-start mb-2">
                  <h3 className="text-xl font-black text-gray-900">{castle.name}</h3>
                  <span className="text-[10px] bg-gray-100 text-gray-500 px-2 py-1 rounded font-bold uppercase">
                    ID: {castle.id}
                  </span>
                </div>
                <p className="text-sm text-gray-600 mb-5 leading-relaxed">
                  {castle.description}
                </p>

                {/* Maps Buttons */}
                <div className="grid grid-cols-2 gap-3 mb-5">
                  <a href={castle.parking} target="_blank" rel="noopener noreferrer"
                    className="flex flex-col items-center justify-center p-3 rounded-xl bg-gray-50 border border-gray-200 hover:bg-gray-100 transition group">
                    <MapPin size={20} className="text-red-500 mb-1 group-hover:scale-110 transition-transform" />
                    <span className="text-[10px] font-bold text-gray-400 uppercase">Parking</span>
                    <span className="text-xs font-black text-gray-700 flex items-center gap-1">
                      Mapã‚’è¡¨ç¤º <ExternalLink size={10} />
                    </span>
                  </a>
                  <a href={castle.stamp} target="_blank" rel="noopener noreferrer"
                    className="flex flex-col items-center justify-center p-3 rounded-xl bg-indigo-50 border border-indigo-100 hover:bg-indigo-100 transition group">
                    <Navigation size={20} className="text-indigo-600 mb-1 group-hover:scale-110 transition-transform" />
                    <span className="text-[10px] font-bold text-indigo-400 uppercase">Stamp</span>
                    <span className="text-xs font-black text-indigo-900 flex items-center gap-1">
                      å ´æ‰€ã¸ãƒŠãƒ“ <ExternalLink size={10} />
                    </span>
                  </a>
                </div>

                {/* Info List */}
                <div className="space-y-3 bg-gray-50 p-4 rounded-xl border border-gray-100">
                  <div className="flex items-center gap-2 text-xs">
                    <Clock size={14} className="text-gray-400" />
                    <span className="font-bold text-gray-500">å–¶æ¥­æ™‚é–“:</span>
                    <span className="font-bold text-gray-900">{castle.hours}</span>
                  </div>
                  <div className="flex items-start gap-2 text-xs">
                    <AlertTriangle size={14} className="text-amber-500 mt-0.5 shrink-0" />
                    <div>
                      <span className="font-bold text-amber-600 block mb-0.5">ç•™æ„ç‚¹:</span>
                      <span className="text-gray-700 font-medium leading-normal">{castle.warning}</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>

      <footer className="max-w-xl mx-auto px-4 mt-8 text-center">
        <div className="bg-white rounded-xl p-4 border border-gray-200 shadow-sm">
          <p className="text-[10px] font-bold text-gray-400 uppercase mb-2">Travel Status</p>
          <div className="flex justify-between items-center text-xs font-black text-gray-600">
            <span>START: å²¡å±±é§…</span>
            <ChevronRight size={14} />
            <span className="text-indigo-600">ç¾åœ¨åœ°ä»˜è¿‘ã‚’æ”»ç•¥ä¸­</span>
            <ChevronRight size={14} />
            <span>GOAL: å²¡å±±é§…</span>
          </div>
        </div>
        <p className="text-[10px] text-gray-400 mt-6 mb-12">
          Â© 2026 Castle Rally Navigator â€¢ Progress saved automatically.
        </p>
      </footer>
    </div>
  );
};

export default App;
